<!DOCTYPE html>
<!--
Link: https://thomasyicui.github.io/Survive/
CONTROLS: 
    -Number pad to switch items
    -WASD or Arrow keys to move
-->
<html>
    <head>
        <meta charset="utf-8">
        <title>Game</title>
        <style>
            body {
                position: fixed;
            }
            #canvi {
                margin-left: -10px;
                margin-top: -10px;
            }
        </style>
    </head>
<body>
    <canvas id="canvi"></canvas>
    <script>
        // makes it more like javascript
        var canvas = document.getElementById("canvi");
        var ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        var mouseX = 0;
        var mouseY = 0;
        var clicked = false
        var keys = [];
        canvas.addEventListener("mousemove", function(e) {
            var cRect = canvas.getBoundingClientRect();
            mouseX = Math.round(e.clientX - cRect.left);
            mouseY = Math.round(e.clientY - cRect.top);
        });
        canvas.addEventListener("mousedown", function(e) {
            dragged = true;
        }, false);
        canvas.addEventListener("mouseup", function(e) {
            if(dragged === true) {
                clicked = true;
                dragged = false;
            }
        });
        window.addEventListener("keydown", keysPressed, false);
        window.addEventListener("keyup", keysReleased, false);
        function keysPressed(e) {
            // store an entry for every key pressed
            keys[e.keyCode] = true;
            e.preventDefault();
        }
        function keysReleased(e) {
            // mark keys that were released
            keys[e.keyCode] = false;
        }
        function cos(r) {
            return Math.cos(r);
        }
        function sin(r) {
            return Math.sin(r);
        }
        function atan2(y, x) {
            return Math.atan2(y, x);
        }
        function round(num) {
            return Math.round(num);
        }
        function random(min, max) {
            return min + Math.random(0, 1) * (max - min);
        }
        function dist(x, y, x2, y2) {
            var a = x - x2;
            var b = y - y2;
            return Math.sqrt(a * a + b * b);
        }
        function text(txt, x, y, size) {
            ctx.font = size + "px Arial";
            ctx.fillText(txt, x, y);
        }
        function fill(r, g, b, a) {
            if(a === undefined) {
                a = 1;
            }
            ctx.fillStyle = "rgba(" + r + ", " + g + ", " + b + ", " + a + ")";
        }
        function stroke(r, g, b) {
            ctx.strokeStyle = "rgb(" + r + ", " + g + ", " + b + ")";
        }
        function rect(x, y, w, h, r) {
            ctx.save();
            ctx.translate(x, y)
            ctx.rotate(r);
            ctx.fillRect(0, 0, w, h);
            ctx.restore();
        }
        function strokeWeight(s) {
            ctx.lineWidth = s;
        }
        function eRect(x, y, w, h, col) {
            ctx.beginPath();
            stroke(col[0], col[1], col[2]);
            ctx.rect(x, y, w, h);
            ctx.stroke();
        }
        function start() {
            var myVar = setInterval(draw, 1);
        }
        function textAlign(align) {
            ctx.textAlign = align;
        }
        function lerp(a, b, t) {
            return a + (b - a) * t;
        }
        function dist2(a, b, d) {
            return (a - b) > -d && (a - b) < d;
        }
        function ellipse(x, y, radiusX, radiusY, rotation) {
            ctx.beginPath();
            ctx.ellipse(x, y, radiusX, radiusY, rotation, 0, 2 * Math.PI);
            ctx.fill();
        }
        function eEllipse(x, y, radiusX, radiusY, rotation) {
            ctx.beginPath();
            ctx.ellipse(x, y, radiusX, radiusY, rotation, 0, 2 * Math.PI);
            ctx.stroke();
        }
        function constrain(num, m, ma) {
            if(num < m) {
                num = m;
            } else if(num > ma) {
                num = ma;
            }
            return num;
        }
    </script>
    <script>
var scene = "game";
var player = "";
var trees = [];
function drawItems(x, y, inv, i, d, r) {
    if(d === true) {
        if(inv[i] === "axe") {
            fill(100, 75, 0);
            rect(canvas.width/2 - (inv.length * 25) + i * 60 + 20, canvas.height - 50, 5, 40, -0.5)
            fill(100, 100, 100);
            rect(canvas.width/2 - (inv.length * 25) + i * 60 + 35, canvas.height - 37, 25, 15, 2.6)
        } else if(inv[i] === "apple") {
            fill(255, 10, 10);
            ellipse(canvas.width/2 - (inv.length * 25) + i * 85, canvas.height - 35, 17, 17, 0)
            fill(100, 75, 0);
            rect(canvas.width/2 - (inv.length * 25) + i * 85 - 10, canvas.height - 45, 13, 5, -2)
        } else if(inv[i] === "barracks") {
            fill(100, 75, 0);
            rect(canvas.width/2 - (inv.length * 25) + i * 85 - 30, canvas.height - 35, 5, 20, 0)
            fill(255, 255, 255);
            rect(canvas.width/2 - (inv.length * 25) + i * 85 - 41, canvas.height - 45, 17, 5, -0.6);
            rect(canvas.width/2 - (inv.length * 25) + i * 85 - 41, canvas.height - 35, 17, 5, -0.6);
            rect(canvas.width/2 - (inv.length * 25) + i * 85 - 41, canvas.height - 25, 17, 5, -0.6);
            rect(canvas.width/2 - (inv.length * 25) + i * 85 - 29, canvas.height - 55, 17, 5, 0.6);
            rect(canvas.width/2 - (inv.length * 25) + i * 85 - 29, canvas.height - 45, 17, 5, 0.6);
            rect(canvas.width/2 - (inv.length * 25) + i * 85 - 29, canvas.height - 35, 17, 5, 0.6);
            fill(0, 100, 255);
            rect(canvas.width/2 - (inv.length * 25) + i * 85 - 41, canvas.height - 40, 17, 5, -0.6);
            rect(canvas.width/2 - (inv.length * 25) + i * 85 - 41, canvas.height - 30, 17, 5, -0.6);
            rect(canvas.width/2 - (inv.length * 25) + i * 85 - 41, canvas.height - 20, 17, 5, -0.6);
            rect(canvas.width/2 - (inv.length * 25) + i * 85 - 29, canvas.height - 50, 17, 5, 0.6);
            rect(canvas.width/2 - (inv.length * 25) + i * 85 - 29, canvas.height - 40, 17, 5, 0.6);
            rect(canvas.width/2 - (inv.length * 25) + i * 85 - 29, canvas.height - 30, 17, 5, 0.6);
        }
    } else {
        if(inv[i] === "axe") {
            fill(100, 75, 0);
            rect(x - 21, y - 25, 5, 40, 0)
            fill(100, 100, 100);
            rect(x - 38, y - 23, 25, 15, 0)
        } else if(inv[i] === "apple") {
            fill(255, 10, 10);
            ellipse(x - 25, y, 10, 10, 0)
            fill(100, 75, 0);
            rect(x - 32, y - 11, 7, 2, 1)
        } else if(inv[i] === "barracks") {
            fill(100, 75, 0);
            rect(x - 30, y - 0, 5, 20, -0.1);
            fill(255, 255, 255);
            for(var i = 0; i < 6; i+=1) {
                rect(x - 40 + Math.floor(i/3) * 12, y - 35 + i % 3 * 10 - Math.floor(i/3) * 10 + 25, 17, 5, -0.6 + Math.floor(i/3) * 1.2)
            }
            fill(0, 100, 255);
            for(var i = 0; i < 6; i+=1) {
                rect(x - 40 + Math.floor(i/3) * 12, y - 30 + i % 3 * 10 - Math.floor(i/3) * 10 + 25, 17, 5, -0.6 + Math.floor(i/3) * 1.2)
            }
        }
    }
}
function Player() {
    this.x = round(random(-4000, 4000));
    this.y = round(random(-4000, 4000));
    this.r = atan2(canvas.height/2 - mouseY, canvas.width/2 - mouseX);
    this.inv = ["axe", "apple", "barracks"];
    this.holding = 0;
};
Player.prototype.update = function() {
    this.r = atan2(canvas.height/2 - mouseY, canvas.width/2 - mouseX);
    if(keys[87] || keys[38]) {
        this.y-=1;
    }
    if(keys[83] || keys[40]) {
        this.y+=1;
    }
    if(keys[65] || keys[37]) {
        this.x-=1;
    }
    if(keys[68] || keys[39]) {
        this.x+=1;
    }
    this.x = constrain(this.x, -4000, 4000);
    this.y = constrain(this.y, -4000, 4000)
};
Player.prototype.draw = function() {
    fill(255, 200, 100);
    ellipse(canvas.width/2, canvas.height/2, 10, 10, 0);
    ellipse(canvas.width/2 - cos(this.r + 0.5) * 17.5, canvas.height/2 - sin(this.r + 0.5) * 17.5, 5, 5, 0);
    ellipse(canvas.width/2 - cos(this.r - 0.5) * 17.5, canvas.height/2 - sin(this.r - 0.5) * 17.5, 5, 5, 0);
    ctx.save();
    ctx.translate(canvas.width/2, canvas.height/2);
    ctx.rotate(this.r);
    drawItems(0, 0, this.inv, this.holding);
    ctx.restore();
};
Player.prototype.ui = function() {
    for(var i = 0; i < this.inv.length; i+=1) {
        fill(0, 0, 0, 0.1);
        rect(canvas.width/2 - (this.inv.length * 25) + i * 60, canvas.height - 60, 50, 50);
        if(keys[49 + i]) {
            this.holding = i;
        }
        drawItems(0, 0, this.inv, i, true);
    }
};
function tree() {
    this.x = round(random(-4000, 4000));
    this.y = round(random(-4000, 4000));
    this.s = round(random(50, 100));
};
tree.prototype.draw = function() {
    if(player.x >= this.x - canvas.width/2 - this.s/2 - 25 && player.x <= this.x + canvas.width/2 + this.s + 25 && player.y >= this.y - canvas.height/2 - this.s/2 - 25 && player.y <= this.y + canvas.height/2 + this.s * 2 + 25) {
        fill(0, 150 + cos(this.x + this.y) * 9, 0);
        ellipse(this.x - player.x + canvas.width/2, this.y - player.y + canvas.width/2, this.s, this.s, 0);
        var x = this.x - player.x + canvas.width/2;
        var y = this.y - player.y + canvas.width/2;
        var s = this.s * 0.95;
        for(var i = 0; i < 10; i+=1) {
            rect(x, y, s, s, this.x + i);
        }
        fill(0, 140 + cos(this.x + this.y) * 9, 0)
        ellipse(this.x - player.x + canvas.width/2, this.y - player.y + canvas.width/2, this.s * 0.66, this.s * 0.66, 0);
        x = this.x - player.x + canvas.width/2;
        y = this.y - player.y + canvas.width/2;
        s = this.s * 0.61;
        for(var i = 0; i < 10; i+=1) {
            rect(x, y, s, s, this.x + i);
        }
        fill(0, 130 + cos(this.x + this.y) * 9, 0)
        ellipse(this.x - player.x + canvas.width/2, this.y - player.y + canvas.width/2, this.s * 0.33, this.s * 0.33, 0);
        x = this.x - player.x + canvas.width/2;
        y = this.y - player.y + canvas.width/2;
        s = this.s * 0.36;
        for(var i = 0; i < 10; i+=1) {
            rect(x, y, s, s, this.x + i);
        }
    }
};
tree.prototype.collide = function() {
    
};
var player = new Player();
for(var i = 0; i < 100; i+=1) {
    trees.push(new tree());
}
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    switch(scene) {
        case "game":
            fill(0, 200, 0);
            rect(0, 0, canvas.width, canvas.height, 0);
            player.update();
            player.draw();
            for(var i = 0; i < trees.length; i+=1) {
                trees[i].draw();
            }
            player.ui();
            fill(255, 255, 255);
            text("Position: " + player.x + ", " + player.y, 5, 15, 12);
        break;
    }
};
draw();
start();
    </script>
</body>
</html>
