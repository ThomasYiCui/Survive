<!DOCTYPE html>
<!--
Link: https://thomasyicui.github.io/Survive/
CONTROLS: 
    -Number pad to switch items
    -WASD or Arrow keys to move
Change Log:
    April 10 2022
        -added blocks (not fineshed yet)
        -add block building (not fineshed yet)
        -made a 15 cap for building blocks
        (I will work on stone and mateirals next and school will slow down progress)
    April 11 2022
        -added so if you hit tree of stone you get the matierial
        -added so you can heal with the apple: +20 hp -10 food
        -added so when you build it uses 10 wood
        -pressing space uses the tool
        -added bush, you can hit it to get food.
    April 12 2022
        -fized collision (thanks to Dominic R.)
        -
-->
<html>
    <head>
        <meta charset="utf-8">
        <title>Game</title>
        <style>
            body {
                position: fixed;
            }
            #canvi {
                margin: -10px;
            }
        </style>
    </head>
<body>
    <canvas id="canvi"></canvas>
    <script>
        // makes it more like javascript
        var canvas = document.getElementById("canvi");
        var ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        var mouseX = 0;
        var mouseY = 0;
        var clicked = false
        var keys = [];
        canvas.addEventListener("mousemove", function(e) {
            var cRect = canvas.getBoundingClientRect();
            mouseX = Math.round(e.clientX - cRect.left);
            mouseY = Math.round(e.clientY - cRect.top);
        });
        canvas.addEventListener("mousedown", function(e) {
            dragged = true;
        }, false);
        canvas.addEventListener("mouseup", function(e) {
            if(dragged === true) {
                clicked = true;
                dragged = false;
            }
        });
        window.addEventListener("keydown", keysPressed, false);
        window.addEventListener("keyup", keysReleased, false);
        function keysPressed(e) {
            // store an entry for every key pressed
            keys[e.keyCode] = true;
            e.preventDefault();
        }
        function keysReleased(e) {
            // mark keys that were released
            keys[e.keyCode] = false;
        }
        function cos(r) {
            return Math.cos(r);
        }
        function sin(r) {
            return Math.sin(r);
        }
        function atan2(y, x) {
            return Math.atan2(y, x);
        }
        function round(num) {
            return Math.round(num);
        }
        function random(min, max) {
            return min + Math.random(0, 1) * (max - min);
        }
        function dist(x, y, x2, y2) {
            var a = x - x2;
            var b = y - y2;
            return Math.sqrt(a * a + b * b);
        }
        function text(txt, x, y, size) {
            ctx.font = size + "px Arial";
            ctx.fillText(txt, x, y);
        }
        function fill(r, g, b, a) {
            if(a === undefined) {
                a = 1;
            }
            ctx.fillStyle = "rgba(" + r + ", " + g + ", " + b + ", " + a + ")";
        }
        function stroke(r, g, b) {
            ctx.strokeStyle = "rgb(" + r + ", " + g + ", " + b + ")";
        }
        function rect(x, y, w, h, r) {
            ctx.save();
            ctx.translate(x, y)
            ctx.rotate(r);
            ctx.fillRect(0, 0, w, h);
            ctx.restore();
        }
        function strokeWeight(s) {
            ctx.lineWidth = s;
        }
        function eRect(x, y, w, h, col) {
            ctx.beginPath();
            stroke(col[0], col[1], col[2]);
            ctx.rect(x, y, w, h);
            ctx.stroke();
        }
        function start() {
            var myVar = setInterval(draw, 1);
        }
        function textAlign(align) {
            ctx.textAlign = align;
        }
        function lerp(a, b, t) {
            return a + (b - a) * t;
        }
        function dist2(a, b, d) {
            return (a - b) > -d && (a - b) < d;
        }
        function ellipse(x, y, radiusX, radiusY, rotation) {
            ctx.beginPath();
            ctx.ellipse(x, y, radiusX, radiusY, rotation, 0, 2 * Math.PI);
            ctx.fill();
        }
        function eEllipse(x, y, radiusX, radiusY, rotation) {
            ctx.beginPath();
            ctx.ellipse(x, y, radiusX, radiusY, rotation, 0, 2 * Math.PI);
            ctx.stroke();
        }
        function constrain(num, m, ma) {
            if(num < m) {
                num = m;
            } else if(num > ma) {
                num = ma;
            }
            return num;
        }
    </script>
    <script>
var scene = "game";
var player = "";
var keyPress = 10;
var trees = [];
var rocks = [];
var bushes = [];
var objects = [];
function drawItems(x, y, inv, i, d, r) {
        if(inv[i] === "axe") {
            fill(100, 75, 0);
            rect(x - 21, y - 25, 5, 40, 0)
            fill(100, 100, 100);
            rect(x - 38, y - 23, 25, 15, 0)
        } else if(inv[i] === "apple") {
            fill(255, 10, 10);
            ellipse(x - 25, y, 10, 10, 0)
            fill(100, 75, 0);
            rect(x - 32, y - 11, 7, 2, 1)
        } else if(inv[i] === "barracks") {
            fill(100, 75, 0);
            rect(x - 30, y - 0, 5, 20, -0.1);
            fill(255, 255, 255);
            for(var i = 0; i < 6; i+=1) {
                rect(x - 40 + Math.floor(i/3) * 12, y - 35 + i % 3 * 10 - Math.floor(i/3) * 10 + 25, 17, 5, -0.6 + Math.floor(i/3) * 1.2)
            }
            fill(0, 100, 255);
            for(var i = 0; i < 6; i+=1) {
                rect(x - 40 + Math.floor(i/3) * 12, y - 30 + i % 3 * 10 - Math.floor(i/3) * 10 + 25, 17, 5, -0.6 + Math.floor(i/3) * 1.2)
            }
        } else if(inv[i] === "woodBlock") {
            fill(150, 100, 0);
            rect(x - 45, y - 15, 30, 30, 0);
        }
};

function Player() {
    this.x = round(random(-4000, 4000));
    this.y = round(random(-4000, 4000));
    this.r = atan2(canvas.height/2 - mouseY, canvas.width/2 - mouseX);
    this.inv = ["axe", "apple", "barracks", "woodBlock"];
    this.holding = 0;
    this.s = 10;
    this.stone = 0;
    this.wood = 0;
    this.food = 100;
    this.gold = 0;
    this.offset = 0;
    this.offsetA = 0;
    this.weponSize = 5;
    this.weponLength = 15;
    this.hp = 10;
    this.maxHp = 100;
    this.exp = 0;
    this.lvl = 0;
};
Player.prototype.update = function() {
    this.r = atan2(canvas.height/2 - mouseY, canvas.width/2 - mouseX);
    if(keys[87] || keys[38]) {
        this.y-=1;
    }
    if(keys[83] || keys[40]) {
        this.y+=1;
    }
    if(keys[65] || keys[37]) {
        this.x-=1;
    }
    if(keys[68] || keys[39]) {
        this.x+=1;
    }
    if(this.offset > 0) {
        this.offsetA-=0.01;
    } else {
        this.offset = 0;
        this.offsetA = 0;
    }
    this.offset+=this.offsetA;
    this.x = constrain(this.x, -4000, 4000);
    this.y = constrain(this.y, -4000, 4000)
};
Player.prototype.draw = function() {
    fill(255, 200, 100);
    ellipse(canvas.width/2, canvas.height/2, 10, 10, 0);
    ellipse(canvas.width/2 - cos(this.r + this.offset + 0.5) * 17.5, canvas.height/2 - sin(this.r + this.offset + 0.5) * 17.5, 5, 5, 0);
    ellipse(canvas.width/2 - cos(this.r + this.offset - 0.5) * 17.5, canvas.height/2 - sin(this.r + this.offset - 0.5) * 17.5, 5, 5, 0);
    fill(100, 100, 100);
    rect(canvas.width/2 - 15, canvas.height/2 + 15, 30, 5)
    fill(250, 0, 0);
    rect(canvas.width/2 - 15, canvas.height/2 + 15, (30/this.maxHp) * this.hp, 5);
    ctx.save();
    ctx.translate(canvas.width/2, canvas.height/2);
    ctx.rotate(this.r + this.offset);
    drawItems(0, 0, this.inv, this.holding);
    ctx.restore();
};
Player.prototype.ui = function() {
    for(var i = 0; i < this.inv.length; i+=1) {
        fill(0, 0, 0, 0.1);
        rect(canvas.width/2 - (this.inv.length * 25) + i * 60, canvas.height - 60, 50, 50);
        if(keys[49 + i]) {
            this.holding = i;
        }
        drawItems(canvas.width/2 - (this.inv.length * 25) + i * 60 + 55, canvas.height - 35, this.inv, i);
    }
    fill(0, 0, 0, 0.1)
    rect(canvas.width - 110, canvas.height - 40, 100, 30);
    rect(canvas.width - 110, canvas.height - 80, 100, 30);
    rect(canvas.width - 110, canvas.height - 120, 100, 30);
    rect(canvas.width - 110, canvas.height - 160, 100, 30);
    fill(255, 255, 255);
    text(this.food, canvas.width - 60, canvas.height - 20, 20);
    text(this.stone, canvas.width - 60, canvas.height - 60, 20);
    text(this.wood, canvas.width - 60, canvas.height - 100, 20);
    text(this.gold, canvas.width - 60, canvas.height - 140, 20);
    drawItems(canvas.width - 70, canvas.height - 22.5, this.inv, 1);
    fill(100, 100, 100);
    rect(canvas.width/2 - 150, canvas.height - 80, 300, 15)
};
Player.prototype.clicks = function() {
    if(clicked || keys[32] && keyPress <= 0) {
        keyPress = 30;
            switch(this.inv[this.holding]) {
                case "woodBlock":
                    if(this.wood >= 10 && objects.length < 15) {
                        objects.push(new object(this.x + canvas.width/2 + cos(this.r + 3.5) * 50, this.y + canvas.height/2 + sin(this.r + 3.5) * 50, 0, "woodBlock"));
                        this.wood-=10;
                    }
                break;
                case "axe":
                    if(this.offset <= 0) {
                        this.offset = 0.1;
                        this.offsetA = 0.1;
                    }
                break;
            case "apple":
                if(this.hp < 100) {
                    this.food-=10;
                    this.hp+=20;
                    this.hp = constrain(this.hp, 1, 100);
                }
            break;
        }
    }
};

function object(x, y, r, type) {
    this.x = x;
    this.y = y;
    this.r = r;
    this.type = type;
};
object.prototype.draw = function() {
    switch(this.type) {
        case "woodBlock":
            fill(150, 100, 0);
            rect(this.x - player.x, this.y - player.y, 25, 25, this.r);
        break;
    }
};

function tree() {
    this.x = round(random(-4000, 4000));
    this.y = round(random(-4000, 4000));
    this.s = round(random(50, 100));
};
tree.prototype.draw = function() {
    fill(0, 150 + cos(this.x + this.y) * 9, 0);
    ellipse(this.x - player.x + canvas.width/2, this.y - player.y + canvas.width/2, this.s, this.s, 0);
    var x = this.x - player.x + canvas.width/2;
    var y = this.y - player.y + canvas.width/2;
    var s = this.s * 0.95;
    for(var i = 0; i < 10; i+=1) {
        rect(x, y, s, s, this.x + i);
    }
    fill(0, 140 + cos(this.x + this.y) * 9, 0)
    ellipse(this.x - player.x + canvas.width/2, this.y - player.y + canvas.width/2, this.s * 0.66, this.s * 0.66, 0);
    x = this.x - player.x + canvas.width/2;
    y = this.y - player.y + canvas.width/2;
    s = this.s * 0.61;
    for(var i = 0; i < 10; i+=1) {
        rect(x, y, s, s, this.x + i);
    }
    fill(0, 130 + cos(this.x + this.y) * 9, 0)
    ellipse(this.x - player.x + canvas.width/2, this.y - player.y + canvas.width/2, this.s * 0.33, this.s * 0.33, 0);
    x = this.x - player.x + canvas.width/2;
    y = this.y - player.y + canvas.width/2;
    s = this.s * 0.36;
    for(var i = 0; i < 10; i+=1) {
        rect(x, y, s, s, this.x + i);
    }
};
tree.prototype.collide = function(t) {
    if(clicked || keys[32] && keyPress <= 10) {
        if(dist(this.x, (this.y + this.s), t.x + cos(t.r - 180) * t.weponLength, t.y + sin(t.r - 180) * t.weponLength) < this.s + t.weponSize + 10 && t.offset > 0) {
            t.wood+=1;
        }
    }
    while(dist(this.x, (this.y + this.s), t.x, t.y) < this.s) {
        var r = atan2((this.y + this.s) - t.y, this.x - t.x);
        t.x-=cos(r);
        t.y-=sin(r);
    }
};

function rock() {
    this.x = round(random(-4000, 4000));
    this.y = round(random(-4000, 4000));
    this.s = round(random(25, 50));
};
rock.prototype.draw = function() {
    fill(100, 100, 100);
    ellipse(this.x - player.x, this.y - player.y, this.s, this.s, 0);
};
rock.prototype.collide = function(t) {
    while(dist(this.x - canvas.width/2, this.y - canvas.height/2, t.x, t.y) < this.s + 10) {
        var r = atan2((this.y - canvas.height/2) - t.y, (this.x - canvas.width/2) - t.x);
        t.x-=cos(r);
        t.y-=sin(r);
    }
    if(clicked || keys[32] && keyPress <= 10) {
        if(dist(this.x - canvas.width/2, this.y - canvas.height/2, t.x + cos(t.r - 180) * t.weponLength, t.y + sin(t.r - 180) * t.weponLength) < t.weponSize + this.s + 10 && t.offset > 0) {
            t.stone+=1;
        }
    }
};
function bush() {
    this.x = round(random(-4000, 4000));
    this.y = round(random(-4000, 4000));
};
bush.prototype.draw = function() {
    fill(0, 150, 0);
    ellipse(this.x - player.x, this.y - player.y, 20, 20, 0);
    ellipse(this.x - player.x - 20, this.y - player.y, 15, 15, 0);
    ellipse(this.x - player.x + 20, this.y - player.y, 15, 15, 0);
};
bush.prototype.collide = function(t) {
    if(dist(this.x - canvas.width/2, this.y - canvas.height/2, t.x, t.y) < 30) {
        t.x+=constrain((t.x - this.x), -1, 1);
        t.y+=constrain((t.y - this.y), -1, 1);
    }
    if(clicked || keys[32] && keyPress <= 10) {
        if(dist(this.x - canvas.width/2, this.y - canvas.height/2, t.x + cos(t.r - 180) * t.weponLength, t.y + sin(t.r - 180) * t.weponLength) < t.weponSize + 30 && t.offset > 0) {
            t.food+=1;
        }
    }
};

function grid() {
    fill(0, 0, 0, 0.1)
    for(var y = -25; y < canvas.height + 25; y+=25) {
        rect(0, y - player.y % 50, canvas.width, 2, 0);
    }
    for(var x = -25; x < canvas.width + 25; x+=25) {
        rect(x - player.x % 50, 0, 2, canvas.width, 0);
    }
}

var player = new Player();
for(var i = 0; i < 100; i+=1) {
    trees.push(new tree());
}
for(var i = 0; i < 100; i+=1) {
    rocks.push(new rock());
}
for(var i = 0; i < 150; i+=1) {
    bushes.push(new bush());
}
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    switch(scene) {
        case "game":
            fill(0, 200, 0);
            rect(0, 0, canvas.width, canvas.height, 0);
            grid();
            player.update();
            player.draw();
            player.clicks();
            for(var i = 0; i < trees.length; i+=1) {
                if(player.x >= trees[i].x - canvas.width/2 - trees[i].s/2 - 25 && player.x <= trees[i].x + canvas.width/2 + trees[i].s + 25 && player.y >= trees[i].y - canvas.height/2 - trees[i].s/2 && player.y <= trees[i].y + canvas.height + trees[i].s/2 + 25) {
                    trees[i].draw();
                    trees[i].collide(player)
                }
            }
            for(var i = 0; i < rocks.length; i+=1) {
                if(player.x >= rocks[i].x - canvas.width - rocks[i].s - 25 && player.x <= rocks[i].x + canvas.width + rocks[i].s + 25 && player.y >= rocks[i].y - canvas.height - rocks[i].s && player.y <= rocks[i].y + canvas.height + rocks[i].s + 25) {
                    rocks[i].draw();
                    rocks[i].collide(player)
                }
            }
            for(var i = 0; i < bushes.length; i+=1) {
                if(player.x >= bushes[i].x - canvas.width - 20 && player.x < bushes[i].x + 20 && player.y >= bushes[i].y - 10 - canvas.height  && player.y <= bushes[i].y + 10) {
                    bushes[i].draw();
                    bushes[i].collide(player)
                }
            }
            for(var i = 0; i < objects.length; i+=1) {
                if(player.x >= objects[i].x - canvas.width - 37.5 && player.x <= objects[i].x + canvas.width + 37.5 && player.y >= objects[i].y - canvas.height - 12.5 && player.y <= objects[i].y + canvas.height + 37.5) {
                    objects[i].draw();
                }
            }
            player.ui();
            fill(255, 255, 255);
            text("Position: " + round(player.x) + ", " + round(player.y), 5, 15, 12);
        break;
    }
    clicked = false;
    keyPress-=1;
};
draw();
start();
    </script>
</body>
</html>
