<!DOCTYPE html>
<!--
Link: https://thomasyicui.github.io/Survive/
This was made by How-Code? (Also known as Code247)
CONTROLS: 
    -Number pad to switch items
    -WASD or Arrow keys to move
Change Log:
    April 10 2022
        -added blocks (not fineshed yet)
        -add block building (not fineshed yet)
        -made a 15 cap for building blocks
        (I will work on stone and mateirals next and school will slow down progress)
    April 11 2022
        -added so if you hit tree of stone you get the matierial
        -added so you can heal with the apple: +20 hp -10 food
        -added so when you build it uses 10 wood
        -pressing space uses the tool
        -added bush, you can hit it to get food.
        -added food display
        -added a grid pattern
    April 12 2022
        -fized collision (thanks to Dominic R.)
        -added exp and agging (you get exp for getting matierials)
        -added gold and stoen display
        -remade stone graphics from a circle to a heptagon
        -remade bush graphics added berries and changed shape
        -added gold ore you can hit it to get gold
    April 13 2022
        -added wolves
        -wolves now move even if you can't see them
        -wolves collide with trees (I NEED SOMEONE TO FIX THE COLLISION)
        -wolves collide with stone (I NEED SOMEONE TO FIX THE COLLISION)
        -wolves collide with gold (I NEED SOMEONE TO FIX THE COLLISION)
    April 14 2022
        -You can now do damage to wolves
        I will be competing so progross will be slow or will stop entiraly.
    April 20 2022
        I got back and I will get to work
        -Wolves follow you and attack you
        -You get food for killing wolves
        -Fixed thw wolves hit boxes
        -Started work on menu
    April 21 2022
        -Wolves have a name
        -Wolves have a helath bar
        -Menu got updated
        -Added Level System
        -Added Spear [Wepon]
        -Fixed wepon colision
        Started planning things with Milanote
    April 22 2022
        -Added Sword
        -Made wepons rotate and fit in the box
        -Added stone block
        -You can build with stone block
        -Added cookie
        -Blocks now collide with you
        -Blocks now collide with wolves
        Found Glitch that you get age 3 stuff even though you are at age 2 [FIXED]
        -Started cleaning code
    April 23 2022
        -Objects have health
        -You can delete objects by hitting it
        -Added milita soldier graphics
        -Soldiers follow you
        -Soldiers hit and collide with wolves, trees, stone, bushes, and blocks
        -Soldiers can die
        -Made barracks a block
        -If you place barracks it spawn a soldier
-->
<html>
    <head>
        <meta charset="utf-8">
        <title>Game</title>
        <style>
            body {
                position: fixed;
            }
            #canvi {
                margin: -10px;
            }
        </style>
    </head>
<body>
    <canvas id="canvi"></canvas>
    <script>
        // makes it more like javascript
        var canvas = document.getElementById("canvi");
        var ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        var mouseX = 0;
        var mouseY = 0;
        var clicked = false
        var keys = [];
        canvas.addEventListener("mousemove", function(e) {
            var cRect = canvas.getBoundingClientRect();
            mouseX = Math.round(e.clientX - cRect.left);
            mouseY = Math.round(e.clientY - cRect.top);
        });
        canvas.addEventListener("mousedown", function(e) {
            dragged = true;
        }, false);
        canvas.addEventListener("mouseup", function(e) {
            if(dragged === true) {
                clicked = true;
                dragged = false;
            }
        });
        window.addEventListener("keydown", keysPressed, false);
        window.addEventListener("keyup", keysReleased, false);
        function keysPressed(e) {
            // store an entry for every key pressed
            keys[e.keyCode] = true;
            e.preventDefault();
        }
        function keysReleased(e) {
            // mark keys that were released
            keys[e.keyCode] = false;
        }
        function cos(r) {
            return Math.cos(r);
        }
        function sin(r) {
            return Math.sin(r);
        }
        function atan2(y, x) {
            return Math.atan2(y, x);
        }
        function round(num) {
            return Math.round(num);
        }
        function random(min, max) {
            return min + Math.random(0, 1) * (max - min);
        }
        function dist(x, y, x2, y2) {
            var a = x - x2;
            var b = y - y2;
            return Math.sqrt(a * a + b * b);
        }
        function text(txt, x, y, size) {
            ctx.font = size + "px Arial";
            ctx.fillText(txt, x, y);
        }
        function fill(r, g, b, a) {
            if(a === undefined) {
                a = 1;
            }
            ctx.fillStyle = "rgba(" + r + ", " + g + ", " + b + ", " + a + ")";
        }
        function stroke(r, g, b) {
            ctx.strokeStyle = "rgb(" + r + ", " + g + ", " + b + ")";
        }
        function rect(x, y, w, h, r) {
            ctx.save();
            ctx.translate(x, y)
            ctx.rotate(r);
            ctx.fillRect(0, 0, w, h);
            ctx.restore();
        }
        function strokeWeight(s) {
            ctx.lineWidth = s;
        }
        function eRect(x, y, w, h, col) {
            ctx.beginPath();
            stroke(col[0], col[1], col[2]);
            ctx.rect(x, y, w, h);
            ctx.stroke();
        }
        function start() {
            var myVar = setInterval(draw, 1);
        }
        function textAlign(align) {
            ctx.textAlign = align;
        }
        function lerp(a, b, t) {
            return a + (b - a) * t;
        }
        function dist2(a, b, d) {
            return (a - b) > -d && (a - b) < d;
        }
        function ellipse(x, y, radiusX, radiusY, rotation) {
            ctx.beginPath();
            ctx.ellipse(x, y, radiusX, radiusY, rotation, 0, 2 * Math.PI);
            ctx.fill();
        }
        function eEllipse(x, y, radiusX, radiusY, rotation) {
            ctx.beginPath();
            ctx.ellipse(x, y, radiusX, radiusY, rotation, 0, 2 * Math.PI);
            ctx.stroke();
        }
        function constrain(num, m, ma) {
            if(num < m) {
                num = m;
            } else if(num > ma) {
                num = ma;
            }
            return num;
        }
    </script>
    <script>
// Set up
textAlign("center");
// Global varibles
var scene = "menu"; // scene control
var player = ""; // player
var keyPress = 10; // limit space key presses
var trees = []; // tree list
var rocks = []; // rock list
var wolves = []; // wolf list
var golds = []; // gold list
var bushes = []; // bush list
var objects = []; // object list
var soldiers = []; // soldier list

// Misc. functions
function drawItems(x, y, inv, i) {
    ctx.save();
    if(inv[i][0] === "axe") {
        fill(100, 75, 0);
        rect(x - 21, y - 25, 5, 40, 0)
        fill(125, 125, 125);
        rect(x - 38, y - 23, 25, 15, 0)
    } else if(inv[i][0] === "spear") {
        fill(100, 75, 0);
        rect(x - 21, y - 25, 5, 60, 0);
        fill(125, 125, 125);
        rect(x - 13, y + 35, 10, 10, 90)
    } else if(inv[i][0] === "sword") {
        fill(100, 75, 0);
        rect(x - 21, y - 25, 5, 40, 0);
        fill(125, 125, 125);
        rect(x - 23.5, y - 30, 10, 18, 0);
        rect(x - 17, y - 35, 7, 7, 45);
    } else if(inv[i][0] === "apple") {
        fill(255, 10, 10);
        ellipse(x - 25, y, 10, 10, 0)
        fill(100, 75, 0);
        rect(x - 32, y - 11, 7, 2, 1)
    } else if(inv[i][0] === "cookie") {
        fill(158, 74, 0);
        ellipse(x - 25, y, 10, 10, 0);
        fill(100, 40, 0);
        ellipse(x - 21, y - 4, 2, 2, 0);
        ellipse(x - 27.5, y + 1.5, 2, 2, 0);
        ellipse(x - 29, y - 2.5, 2, 2, 0);
        ellipse(x - 22, y + 3, 2, 2, 0);
    } else if(inv[i][0] === "barracks") {
            fill(100, 75, 0);
            rect(x - 30, y - 0, 5, 20, -0.1);
            fill(255, 255, 255);
            for(var i = 0; i < 6; i+=1) {
                rect(x - 40 + Math.floor(i/3) * 12, y - 35 + i % 3 * 10 - Math.floor(i/3) * 10 + 25, 17, 5, -0.6 + Math.floor(i/3) * 1.2)
            }
            fill(0, 100, 255);
            for(var i = 0; i < 6; i+=1) {
                rect(x - 40 + Math.floor(i/3) * 12, y - 30 + i % 3 * 10 - Math.floor(i/3) * 10 + 25, 17, 5, -0.6 + Math.floor(i/3) * 1.2)
            }
    } else if(inv[i][0] === "woodBlock") {
        fill(150, 100, 0);
        rect(x - 45, y - 15, 30, 30, 0);
    } else if(inv[i][0] === "stoneBlock") {
        fill(150, 150, 150);
        rect(x - 45, y - 15, 30, 30, 0);
    }
    ctx.setTransform(1, 0, 0, 1, 0, 0);
    ctx.restore();
};
function rectToRect(x, y, w, h, x2, y2, w2, h2) {
    return x < x2 + w2 &&
        x + w > x2 &&
        y < y2 + h2 &&
        h + y > y2
};
function heptagon(x, y, r) {
    var a = 2 * Math.PI / 7;
    ctx.beginPath();
    for (var i = 0; i < 7; i++) {
        ctx.lineTo(x + r * Math.cos(a * i), y + r * Math.sin(a * i));
    }
    ctx.closePath();
    ctx.fill();
};

// Player functions
function Player() {
    this.x = round(random(-4000, 4000));
    this.y = round(random(-4000, 4000));
    this.r = atan2(canvas.height/2 - mouseY, canvas.width/2 - mouseX);
    this.inv = [["axe", "wepon"], ["apple", "food"], ["barracks", "block"], ["woodBlock", "block"]];
    this.holding = 0;
    this.s = 10;
    this.stone = 100;
    this.wood = 100;
    this.food = 100;
    this.gold = 100;
    this.offset = 0;
    this.offsetA = 0;
    this.weponSize = 10;
    this.weponLength = 30;
    this.weponDamage = 25;
    this.hp = 100;
    this.maxHp = 100;
    this.exp = 0;
    this.lvl = 1;
    // used for upgrading age, LVL Till end of upgrade, LVL so far
    this.upgrade = [1, 0.5];
};
Player.prototype.update = function() {
    this.r = atan2(canvas.height/2 - mouseY, canvas.width/2 - mouseX);
    if(this.exp >= ((this.lvl + (this.lvl + 1)) * 32.5)) {
        this.lvl+=1;
        this.exp = 0;
        this.upgrade[0]+=1;
        this.upgrade[1]+=0.5;
    }
    if(keys[87] || keys[38]) {
        this.y-=1;
    }
    if(keys[83] || keys[40]) {
        this.y+=1;
    }
    if(keys[65] || keys[37]) {
        this.x-=1;
    }
    if(keys[68] || keys[39]) {
        this.x+=1;
    }
    if(this.offset > 0) {
        this.offsetA-=0.01;
    } else {
        this.offset = 0;
        this.offsetA = 0;
    }
    this.offset+=this.offsetA;
    this.x = constrain(this.x, -4000, 4000);
    this.y = constrain(this.y, -4000, 4000)
};
Player.prototype.draw = function() {
    fill(255, 200, 100);
    ellipse(canvas.width/2, canvas.height/2, 10, 10, 0);
    ellipse(canvas.width/2 - cos(this.r + this.offset + 0.5) * 17.5, canvas.height/2 - sin(this.r + this.offset + 0.5) * 17.5, 5, 5, 0);
    ellipse(canvas.width/2 - cos(this.r + this.offset - 0.5) * 17.5, canvas.height/2 - sin(this.r + this.offset - 0.5) * 17.5, 5, 5, 0);
    fill(50, 50, 50);
    rect(canvas.width/2 - 15, canvas.height/2 + 15, 30, 5)
    fill(250, 0, 0);
    rect(canvas.width/2 - 15, canvas.height/2 + 15, (30/this.maxHp) * this.hp, 5);
    ctx.save();
    ctx.translate(canvas.width/2, canvas.height/2);
    ctx.rotate(this.r + this.offset);
    drawItems(0, 0, this.inv, this.holding);
    ctx.restore();
};
Player.prototype.ui = function() {
    for(var i = 0; i < this.inv.length; i+=1) {
        fill(0, 0, 0, 0.1);
        rect(canvas.width/2 - (this.inv[0].length * 25) + i * 60 - 10, canvas.height - 60, 50, 50);
        if(keys[49 + i]) {
            this.holding = i;
        }
        if(this.inv[i][1] === "wepon") {
            ctx.save();
            ctx.translate(canvas.width/2 - (this.inv[0].length * 25) + i * 60 + 45, canvas.height - 35);
            if(this.inv[i][0] === "spear") {
                ctx.scale(0.85, 0.85);
                ctx.translate(-55, -5)
                ctx.rotate(3.8);
                drawItems(0, 0, this.inv, i);
            } else if(this.inv[i][0] === "axe") {
                ctx.translate(-20, 20)
                ctx.rotate(0.8);
                drawItems(0, 0, this.inv, i);
            } else if(this.inv[i][0] === "sword") {
                ctx.translate(-25, 20)
                ctx.rotate(0.8);
                drawItems(0, 0, this.inv, i);
            }
            ctx.restore();
        } else {
            drawItems(canvas.width/2 - (this.inv[0].length * 25) + i * 60 + 45, canvas.height - 35, this.inv, i);
        }
    }
    if(this.upgrade[0] > this.upgrade[1]) {
        if(this.upgrade[1] === 1) {
            fill(0, 0, 0, 0.5);
            button(canvas.width/2 - 45, 10, 50, 50, function() {
                for(var i = 0; i < player.inv.length; i+=1) {
                    if(player.inv[i][1] === "wepon") {
                        player.inv[i][0] = "spear";
                        player.weponSize = 7.5;
                        player.weponLength = 70;
                        player.weponDamage = 45;
                    }
                }
                player.upgrade[0]+=1;
                player.upgrade[1]+=0.5;
            }, ["Spear", 10]);
            fill(0, 0, 0, 0.5)
            button(canvas.width/2 + 20, 10, 50, 50, function() {
                for(var i = 0; i < player.inv.length; i+=1) {
                    if(player.inv[i][1] === "wepon") {
                        player.inv[i][0] = "sword";
                        player.weponSize = 12;
                        player.weponLength = 40;
                        player.weponDamage = 35;
                    }
                }
                player.upgrade[0]+=1;
                player.upgrade[1]+=0.5;
            }, ["Sword", 10]);
        } else if(this.upgrade[1] === 2) {
            fill(0, 0, 0, 0.5)
            button(canvas.width/2 + 20, 10, 50, 50, function() {
                for(var i = 0; i < player.inv.length; i+=1) {
                    if(player.inv[i][1] === "food") {
                        player.inv[i][0] = "cookie";
                        player.weponSize = 12;
                        player.weponLength = 40;
                        player.weponDamage = 35;
                    }
                }
                player.upgrade[0]+=1;
                player.upgrade[1]+=0.5;
            }, ["Cookie", 10]);
            fill(0, 0, 0, 0.5)
            button(canvas.width/2 - 45, 10, 50, 50, function() {
                for(var i = 0; i < player.inv.length; i+=1) {
                    if(player.inv[i][0] === "woodBlock") {
                        player.inv[i][0] = "stoneBlock";
                    }
                }
                player.upgrade[0]+=1;
                player.upgrade[1]+=0.5;
            }, ["Stone Wall", 10]);
        }
    }
    fill(0, 0, 0, 0.1)
    rect(canvas.width - 110, canvas.height - 40, 100, 30);
    rect(canvas.width - 110, canvas.height - 80, 100, 30);
    rect(canvas.width - 110, canvas.height - 120, 100, 30);
    rect(canvas.width - 110, canvas.height - 160, 100, 30);
    // text for matierials
    fill(255, 255, 255);
    text(this.wood, canvas.width - 50, canvas.height - 100, 20);
    text(this.gold, canvas.width - 50, canvas.height - 140, 20);
    text(this.stone, canvas.width - 50, canvas.height - 60, 20);
    text(this.food, canvas.width - 50, canvas.height - 20, 20);
    // display for matierials
    drawItems(canvas.width - 70, canvas.height - 22.5, this.inv, 1);
    fill(100, 100, 100);
    heptagon(canvas.width - 95, canvas.height - 65, 12);
    fill(255, 200, 0);
    heptagon(canvas.width - 95, canvas.height - 145, 12);
    // age
    fill(100, 100, 100);
    rect(canvas.width/2 - 150, canvas.height - 80, 300, 15);
    fill(255, 255, 255);
    rect(canvas.width/2 - 149, canvas.height - 79, (298/((this.lvl + (this.lvl + 1)) * 32.5)) * this.exp, 13)
    fill(255, 255, 255);
    text("Age: " + this.lvl, canvas.width/2, canvas.height - 85);
};
Player.prototype.clicks = function() {
    if(clicked || keys[32] && keyPress <= 0) {
        keyPress = 30;
        switch(this.inv[this.holding][0]) {
            case "woodBlock":
                if(this.wood >= 10 && objects.length < 15) {
                    objects.push(new object(this.x + canvas.width/2 + cos(this.r + 3.5) * 50, this.y + canvas.height/2 + sin(this.r + 3.5) * 50, 0, "woodBlock"));
                    this.wood-=10;
                }
            break;
            case "stoneBlock":
                if(this.stone >= 20 && objects.length < 15) {
                    objects.push(new object(this.x + canvas.width/2 + cos(this.r + 3.5) * 50, this.y + canvas.height/2 + sin(this.r + 3.5) * 50, 0, "stoneBlock"));
                    this.stone-=20;
                }
            break;
            case "barracks":
                if(this.stone >= 20 && this.wood >= 20 && this.gold >= 20 && this.food >= 20 && objects.length < 15) {
                    objects.push(new object(this.x + canvas.width/2 + cos(this.r + 3.5) * 50, this.y + canvas.height/2 + sin(this.r + 3.5) * 50, 0, "barracks"));
                    this.wood-=20;
                    this.stone-=20;
                    this.gold-=20;
                    this.food-=20;
                    soldiers.push(new soldier(player.x + canvas.width/2, player.y + canvas.height/2, "milita"))
                }
            break;
            case "axe":
                if(this.offset <= 0) {
                    this.offset = 0.1;
                    this.offsetA = 0.1;
                }
            break;
            case "spear":
                if(this.offset <= 0) {
                    this.offset = 0.2;
                    this.offsetA = 0.2;
                }
            break;
            case "sword":
                if(this.offset <= 0) {
                    this.offset = 0.15;
                    this.offsetA = 0.15;
                }
            break;
            case "apple":
                if(this.hp < 100 && this.food >= 10) {
                    this.food-=10;
                    this.hp+=20;
                    this.hp = constrain(this.hp, 1, 100);
                }
            break;
            case "cookie":
                if(this.hp < 100 && this.food >= 20) {
                    this.food-=20;
                    this.hp+=40;
                    this.hp = constrain(this.hp, 1, 100);
                }
            break;
        }
    }
};
Player.prototype.reset = function() {
    this.x = round(random(-4000, 4000));
    this.y = round(random(-4000, 4000));
    this.r = atan2(canvas.height/2 - mouseY, canvas.width/2 - mouseX);
    this.inv = [["axe", "wepon"], ["apple", "food"], ["barracks", "block"], ["woodBlock", "block"]];
    this.holding = 0;
    this.s = 10;
    this.stone = 100;
    this.wood = 100;
    this.food = 100;
    this.gold = 100;
    this.offset = 0;
    this.offsetA = 0;
    this.weponSize = 10;
    this.weponLength = 30;
    this.weponDamage = 25;
    this.hp = 100;
    this.maxHp = 100;
    this.exp = 0;
    this.lvl = 1;
    this.upgrade = [1, 2];
};

// Object functions
function object(x, y, r, type) {
    this.x = x;
    this.y = y;
    this.r = r;
    this.type = type;
    switch(this.type) {
        case "woodBlock":
            this.size = [25, 25];
            this.health = 380;
            this.gives = [20, 0, 0, 0]
        break;
        case "stoneBlock":
            this.size = [25, 25];
            this.health = 900;
            this.gives = [0, 20, 0, 0]
        break;
        case "barracks":
            this.size = [25, 50];
            this.health = 400;
            this.gives = [20, 20, 20, 20];
        break;
    }
};
object.prototype.draw = function() {
    switch(this.type) {
        case "woodBlock":
            fill(150, 100, 0);
            rect(this.x - player.x, this.y - player.y, 25, 25, this.r);
        break;
        case "stoneBlock":
            fill(100, 100, 100);
            rect(this.x - player.x, this.y - player.y, 25, 25, this.r);
        break;
        case "barracks":
            fill(100, 75, 0);
            rect(this.x - player.x + 15, this.y - player.y - 15, 5, 20, -0.1);
            fill(255, 255, 255);
            for(var i = 0; i < 6; i+=1) {
                rect(this.x - player.x + 5 + Math.floor(i/3) * 12, this.y - player.y - 20 + i % 3 * 10 - Math.floor(i/3) * 10 + 25, 17, 5, -0.6 + Math.floor(i/3) * 1.2)
            }
            fill(0, 100, 255);
            for(var i = 0; i < 6; i+=1) {
                rect(this.x - player.x + 5 + Math.floor(i/3) * 12, this.y - player.y - 15 + i % 3 * 10 - Math.floor(i/3) * 10 + 25, 17, 5, -0.6 + Math.floor(i/3) * 1.2)
            }
        break;
    }
};
object.prototype.collide = function(t, x, y) {
    if(rectToRect(this.x, this.y, this.size[0] + 10, this.size[1] + 10, t.x + x, t.y + y, 20, 20)) {
        t.x-=(this.x - (t.x + x))/20;
        t.y-=(this.y - (t.y + y))/20;
    }
    if(x > 0 && rectToRect(this.x, this.y, this.size[0] + 10, this.size[1] + 10, t.x + cos(t.r - 160) * t.weponLength + x, t.y + sin(t.r - 160) * t.weponLength + y, t.weponSize, t.weponSize)) {
        if(clicked || keys[32] && keyPress <= 10) {
            this.health-=t.weponDamage;
        }
    }
};

// Tree functions
function tree() {
    this.x = round(random(-4000, 4000));
    this.y = round(random(-4000, 4000));
    this.s = round(random(50, 100));
};
tree.prototype.draw = function() {
    fill(0, 150 + cos(this.x + this.y) * 9, 0);
    ellipse(this.x - player.x, this.y - player.y, this.s, this.s, 0);
    var x = this.x - player.x;
    var y = this.y - player.y;
    var s = this.s * 0.95;
    for(var i = 0; i < 10; i+=1) {
        rect(x, y, s, s, this.x + i);
    }
    fill(0, 140 + cos(this.x + this.y) * 9, 0)
    ellipse(this.x - player.x, this.y - player.y, this.s * 0.66, this.s * 0.66, 0);
    s = this.s * 0.61;
    for(var i = 0; i < 10; i+=1) {
        rect(x, y, s, s, this.x + i);
    }
    fill(0, 130 + cos(this.x + this.y) * 9, 0)
    ellipse(this.x - player.x, this.y - player.y, this.s * 0.33, this.s * 0.33, 0);
    s = this.s * 0.36;
    for(var i = 0; i < 10; i+=1) {
        rect(x, y, s, s, this.x + i);
    }
};
tree.prototype.collide = function(t, x, y) {
    if(x === undefined) {
        x = 0;
    }
    if(y === undefined) {
        y = 0;
    }
    while(dist(this.x - canvas.width/2 + x, this.y - canvas.height/2 + y, t.x, t.y) < this.s + 10) {
        var r = atan2((this.y - canvas.height/2) - t.y, (this.x - canvas.width/2) - t.x);
        t.x-=cos(r);
        t.y-=sin(r);
    }
    if(clicked || keys[32] && keyPress <= 10 && x === 0) {
        if(dist(this.x - canvas.width/2, this.y - canvas.height/2, t.x + cos(t.r - 160) * t.weponLength, t.y + sin(t.r - 160) * t.weponLength) < t.weponSize + this.s + 10 && t.offset > 0) {
            t.wood+=1;
            t.exp+=1;
        }
    }
};

// Rock functions
function rock() {
    this.x = round(random(-4000, 4000));
    this.y = round(random(-4000, 4000));
    this.s = round(random(25, 50));
};
rock.prototype.draw = function() {
    fill(100, 100, 100);
    heptagon(this.x - player.x, this.y - player.y, this.s + 5)
};
rock.prototype.collide = function(t, x, y) {
    if(x === undefined) {
        x = 0;
    }
    if(y === undefined) {
        y = 0;
    }
    while(dist(this.x - canvas.width/2 + x, this.y - canvas.height/2 + y, t.x, t.y) < this.s + 10) {
        var r = atan2((this.y - canvas.height/2) - t.y, (this.x - canvas.width/2) - t.x);
        t.x-=cos(r);
        t.y-=sin(r);
    }
    if(clicked || keys[32] && keyPress <= 10) {
        if(dist(this.x - canvas.width/2, this.y - canvas.height/2, t.x + cos(t.r - 160) * t.weponLength, t.y + sin(t.r - 160) * t.weponLength) < t.weponSize + this.s + 10 && t.offset > 0) {
            t.stone+=1;
            t.exp+=1;
        }
    }
};

// Gold functions
function gold() {
    this.x = round(random(-4000, 4000));
    this.y = round(random(-4000, 4000));
    this.s = round(random(25, 50));
};
gold.prototype.draw = function() {
    fill(255, 200, 0);
    heptagon(this.x - player.x, this.y - player.y, this.s + 5)
};
gold.prototype.collide = function(t, x, y) {
    if(x === undefined) {
        x = 0;
    }
    if(y === undefined) {
        y = 0;
    }
    while(dist(this.x - canvas.width/2 + x, this.y - canvas.height/2 + y, t.x, t.y) < this.s + 10) {
        var r = atan2((this.y - canvas.height/2 + y) - t.y, (this.x - canvas.width/2 + x) - t.x);
        t.x-=cos(r);
        t.y-=sin(r);
    }
    if(clicked || keys[32] && keyPress <= 10) {
        if(dist(this.x - canvas.width/2, this.y - canvas.height/2, t.x + cos(t.r - 160) * t.weponLength, t.y + sin(t.r - 160) * t.weponLength) < t.weponSize + this.s + 10 && t.offset > 0) {
            t.gold+=1;
            t.exp+=1;
        }
    }
};

// Bush functions
function bush() {
    this.x = round(random(-4000, 4000));
    this.y = round(random(-4000, 4000));
};
bush.prototype.draw = function() {
    fill(0, 150, 0);
    ellipse(this.x - player.x, this.y - player.y, 20, 20, 0);
    ellipse(this.x - player.x + cos(this.x) * 10, this.y - player.y + sin(this.x) * 10, 15, 15, 0);
    ellipse(this.x - player.x - cos(this.y) * 10, this.y - player.y - sin(this.y) * 10, 15, 15, 0);
    ellipse(this.x - player.x + cos(this.x) * 10, this.y - player.y + cos(this.x) * 10, 15, 15, 0);
    ellipse(this.x - player.x - cos(this.y) * 10, this.y - player.y - sin(this.y) * 10, 15, 15, 0);
    fill(255, 0, 0)
    ellipse(this.x - player.x + cos(this.x) * 10 - 5, this.y - player.y + sin(this.x) * 10 + 5, 2, 2, 0);
    ellipse(this.x - player.x - cos(this.y) * 10 + 5, this.y - player.y - sin(this.y) * 10 - 5, 2, 2, 0);
    ellipse(this.x - player.x + cos(this.x) * 10 - 5, this.y - player.y + cos(this.x) * 10 - 5, 2, 2, 0);
    ellipse(this.x - player.x - cos(this.y) * 10 + 5, this.y - player.y - sin(this.y) * 10 + 5, 2, 2, 0);;
};
bush.prototype.collide = function(t, x, y) {
    if(x === undefined) {
        x = 0;
    }
    if(y === undefined) {
        y = 0;
    }
    while(dist(this.x - canvas.width/2 + x, this.y - canvas.height/2 + y, t.x, t.y) < 30) {
        var r = atan2((this.y - canvas.height/2 + y) - t.y, (this.x - canvas.width/2 + x) - t.x);
        t.x-=cos(r);
        t.y-=sin(r);
    }
    if(clicked || keys[32] && keyPress <= 10) {
        if(dist(this.x - canvas.width/2, this.y - canvas.height/2, t.x + cos(t.r - 160) * t.weponLength, t.y + sin(t.r - 160) * t.weponLength) < t.weponSize + 30 && t.offset > 0) {
            t.food+=1;
            t.exp+=1;
        }
    }
};

// Wolf functions
function wolf(x, y) {
    this.x = x;
    this.y = y;
    this.r = 0;
    this.ar = -0.05;
    this.t = 0;
    this.hp = 100;
    this.damage = 1;
};
wolf.prototype.draw = function() {
    fill(100, 100, 100)
    ellipse(this.x - player.x, this.y - player.y, 20, 15, this.r);
    fill(100, 100, 100)
    ellipse(this.x - player.x + cos(this.r) * 20, this.y - player.y + sin(this.r) * 20, 12.5, 12.5, this.r);
    fill(50, 50, 50);
    rect(this.x - player.x - 12.5, this.y - player.y + 20, 25, 5);
    fill(255, 0, 0);
    rect(this.x - player.x - 12.5, this.y - player.y + 20, this.hp/4, 5);
    fill(255, 255, 255);
    text("Wolf", this.x - player.x, this.y - player.y - 20, 20);
};
wolf.prototype.update = function() {
    this.t-=1;
    this.x+=cos(this.r);
    this.y+=sin(this.r);
    this.r -= random(0, this.ar);
    if(this.t <= 0) {
        if(random(0, 1) < 0.5) {
            this.ar = -0.05;
        } else {
            this.ar = 0.05;
        }
        this.t = round(random(50, 150))
    }
    this.x = constrain(this.x, -4000 - canvas.width/2, 4000 + canvas.width/2);
    this.y = constrain(this.y, -4000 - canvas.height/2, 4000 + canvas.height/2);
};
wolf.prototype.collide = function(t) {
    if(dist(this.x - canvas.width/2, this.y - canvas.height/2, t.x, t.y) < canvas.width/2 + canvas.height/2) {
        this.r = atan2((player.y + canvas.height/2) - this.y, (player.x + canvas.width/2) - this.x);
        this.ar = 0;
        while(dist(this.x - canvas.width/2, this.y - canvas.height/2, t.x, t.y) < 40) {
            var r = atan2((this.y - canvas.height/2) - t.y, (this.x - canvas.width/2) - t.x);
            t.x-=cos(r);
            t.y-=sin(r);
            t.hp-=this.damage;
        }
        if(clicked || keys[32] && keyPress <= 10) {
            if(dist(this.x - canvas.width/2, this.y - canvas.height/2, t.x + cos(t.r - 160 + t.offset) * t.weponLength, t.y + sin(t.r - 160 + t.offset) * t.weponLength) < t.weponSize + 30 && t.offset > 0) {
                this.hp-=t.weponDamage;
            }
        }
    }
};

// Soldier functions
function soldier(x, y, type) {
    this.x = x;
    this.y = y;
    this.type = type;
    this.r = 0;
    this.coolDown = 0;
    switch(this.type) {
        case "milita":
            this.maxHp = 100;
            this.health = this.maxHp;
            this.damage = 25;
            this.reload = 20;
        break;
    }
};
soldier.prototype.draw = function() {
    fill(255, 200, 100);
    ellipse(this.x - player.x, (this.y - player.y), 10, 10, 0);
    ellipse((this.x - player.x) - cos(this.r + this.offset + 0.5) * 17.5, (this.y - player.y) - sin(this.r + this.offset + 0.5) * 17.5, 5, 5, 0);
    ellipse((this.x - player.x) - cos(this.r + this.offset - 0.5) * 17.5, (this.y - player.y) - sin(this.r + this.offset - 0.5) * 17.5, 5, 5, 0);
    fill(50, 50, 50);
    rect((this.x - player.x) - 15, (this.y - player.y) + 15, 30, 5)
    fill(250, 0, 0);
    rect((this.x - player.x) - 15, (this.y - player.y) + 15, (30/this.maxHp) * this.health, 5);
};
soldier.prototype.update = function() {
    if(dist(this.x, this.y, round(player.x + canvas.width/2), round(player.y + canvas.height/2)) > 100) {
        if(this.x < player.x + canvas.width/2) {
            this.x+=1;
        } else if(this.x > player.x + canvas.width/2) {
            this.x-=1;
        }
        if(this.y < player.y + canvas.height/2) {
            this.y+=1;
        } else if(this.y > player.y + canvas.height/2) {
            this.y-=1;
        }
    }
    this.coolDown-=1;
    if(this.health <= 100 && round(random(0, 100)) < 1) {
        this.health+=20;
        this.health = constrain(this.health, 0, 100)
    }
};
soldier.prototype.collide = function(t, hurt) {
    if(dist(this.x, this.y, t.x, t.y) < 25) {
        var r = atan2((this.y - canvas.height/2) - t.y, (this.x - canvas.width/2) - t.x);
        t.x-=(this.x - t.x)/(dist(this.x, this.y, t.x, t.y));
        t.y-=(this.y - t.y)/(dist(this.x, this.y, t.x, t.y));
        this.x+=(this.x - t.x)/(dist(this.x, this.y, t.x, t.y));
        this.y+=(this.y - t.y)/(dist(this.x, this.y, t.x, t.y));
        if(hurt) {
            this.health-=t.damage;
            if(this.coolDown <= 0) {
                t.hp-=this.damage;
                this.coolDown = this.reload;
            }
        }
    }
};

function grid() {
    fill(0, 0, 0, 0.1)
    for(var y = -25; y < canvas.height + 25; y+=25) {
        rect(0, y - player.y % 50, canvas.width, 2, 0);
    }
    for(var x = -25; x < canvas.width + 25; x+=25) {
        rect(x - player.x % 50, 0, 2, canvas.height, 0);
    }
}

var player = new Player();
// Tree spawning
for(var i = 0; i < 100; i+=1) {
    trees.push(new tree());
}
// Rock spawning
for(var i = 0; i < 100; i+=1) {
    rocks.push(new rock());
}
// Bush spawning
for(var i = 0; i < 150; i+=1) {
    bushes.push(new bush());
}
// Gold spawning
for(var i = 0; i < 50; i+=1) {
    golds.push(new gold());
}
// Wolf spawning
for(var i = 0; i < 100; i+=1) {
    wolves.push(new wolf(round(random(-4000, 4000)), round(random(-4000, 4000))));
    //wolves.push(new wolf(player.x, player.y));
}
function button(x, y, width, height, does, txt) {
    rect(x, y, width, height, 0);
    fill(255, 255, 255);
    text(txt[0], x + width/2, y + height/2 + txt[1]/2 - 4, txt[1]);
    if(mouseX > x && mouseY > y && mouseX < x + width && mouseY < y + height && clicked) {
        does();
    }
};
function menu() {
    textAlign("center")
    fill(0, 200, 0);
    rect(0, 0, canvas.width, canvas.height, 0);
    grid();
    button(canvas.width/2 -  canvas.width/10, canvas.height * 0.60, canvas.width/5, canvas.width/15, function() {
        scene = "game";
    }, ["Play", canvas.width/30]);
    fill(0, 0, 0);
    text("Game Title", canvas.width/2 + 20 - canvas.width/200, canvas.height/2 - 47, canvas.width/10);
    fill(255, 255, 255);
    text("Game Title", canvas.width/2 + 20, canvas.height/2 - 50, canvas.width/10);
    rect(10, canvas.height/35 + canvas.height/10 - (canvas.width/600) * 3, canvas.width/3.9, canvas.width/4.01);
    fill(0, 0, 0);
    text("How To Play", canvas.width/8 + 10, canvas.height/13 + canvas.height/10, canvas.width/26);
    text("Movement: WASD", canvas.width/8 + 10, canvas.height/13 + canvas.width/26 + canvas.height/10, canvas.width/38)
    text("or arrow keys", canvas.width/8 + 10, canvas.height/13 + canvas.width/26 + canvas.width/38 + canvas.height/10, canvas.width/38);
       
    text("Switch Item: Number", canvas.width/8 + 10, canvas.height/13 + canvas.width/26 + (canvas.width/38) * 2.5 + canvas.height/10, canvas.width/38);
    text("Pad", canvas.width/8 + 10, canvas.height/13 + canvas.width/26 + (canvas.width/38) * 3.5 + canvas.height/10, canvas.width/38);
    
    text("Use Item: Click or", canvas.width/8 + 10, canvas.height/13 + canvas.width/26 + (canvas.width/38) * 5 + canvas.height/10, canvas.width/38);
    text("Space", canvas.width/8 + 10, canvas.height/13 + canvas.width/26 + (canvas.width/38) * 6 + canvas.height/10, canvas.width/38);
};
var entitys = 0;

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    switch(scene) {
        case "menu":
            menu();
        break;
        case "game":
            fill(0, 200, 0);
            rect(0, 0, canvas.width, canvas.height, 0);
            grid();
            player.update();
            player.draw();
            player.clicks();
            for(var i = 0; i < trees.length; i+=1) {
                if(player.x >= trees[i].x - canvas.width - trees[i].s - 25 && player.x <= trees[i].x + canvas.width + trees[i].s + 25 && player.y >= trees[i].y - canvas.height - trees[i].s && player.y <= trees[i].y + canvas.height + trees[i].s + 25) {
                    entitys+=1;
                    trees[i].draw();
                    trees[i].collide(player);
                    for(var j = 0; j < wolves.length; j+=1) {
                        trees[i].collide(wolves[j], canvas.width/2, canvas.height/2);
                    }
                    for(var o = 0; o < soldiers.length; o+=1) {
                        trees[i].collide(soldiers[o], canvas.width/2, canvas.height/2)
                    }
                }
            }
            for(var i = 0; i < rocks.length; i+=1) {
                if(player.x >= rocks[i].x - canvas.width - rocks[i].s - 25 && player.x <= rocks[i].x + canvas.width + rocks[i].s + 25 && player.y >= rocks[i].y - canvas.height - rocks[i].s && player.y <= rocks[i].y + canvas.height + rocks[i].s + 25) {
                    entitys+=1;
                    rocks[i].draw();
                    rocks[i].collide(player)
                    for(var j = 0; j < wolves.length; j+=1) {
                        rocks[i].collide(wolves[j], canvas.width/2, canvas.height/2);
                    }
                    for(var o = 0; o < soldiers.length; o+=1) {
                        rocks[i].collide(soldiers[o], canvas.width/2, canvas.height/2)
                    }
                }
            }
            for(var i = 0; i < golds.length; i+=1) {
                if(player.x >= golds[i].x - canvas.width - golds[i].s - 25 && player.x <= golds[i].x + canvas.width + golds[i].s + 25 && player.y >= golds[i].y - canvas.height - golds[i].s && player.y <= golds[i].y + canvas.height + golds[i].s + 25) {
                    entitys+=1;
                    golds[i].draw();
                    golds[i].collide(player)
                    for(var j = 0; j < wolves.length; j+=1) {
                        golds[i].collide(wolves[j], canvas.width/2, canvas.height/2);
                    }
                    for(var o = 0; o < soldiers.length; o+=1) {
                        golds[i].collide(soldiers[o], canvas.width/2, canvas.height/2)
                    }
                }
            }
            for(var i = 0; i < bushes.length; i+=1) {
                if(player.x >= bushes[i].x - canvas.width - 20 && player.x < bushes[i].x + 20 && player.y >= bushes[i].y - 10 - canvas.height  && player.y <= bushes[i].y + 10) {
                    entitys+=1;
                    bushes[i].draw();
                    for(var j = 0; j < wolves.length; j+=1) {
                        bushes[i].collide(wolves[j], canvas.width/2, canvas.height/2);
                    }
                    for(var o = 0; o < soldiers.length; o+=1) {
                        bushes[i].collide(soldiers[o], canvas.width/2, canvas.height/2)
                    }
                    bushes[i].collide(player)
                }
            }
            // loop through the objects
            for(var i = 0; i < objects.length; i+=1) {
                // if the object is on screen
                if(player.x >= objects[i].x - canvas.width - 37.5 && player.x <= objects[i].x + canvas.width + 37.5 && player.y >= objects[i].y - canvas.height - 12.5 && player.y <= objects[i].y + canvas.height + 37.5) {
                    // add one to the entity counter
                    entitys+=1;
                    // do the functions
                    objects[i].draw();
                    objects[i].collide(player, canvas.width/2, canvas.height/2);
                    // collision with the wolves
                    for(var j = 0; j < wolves.length; j+=1) {
                        objects[i].collide(wolves[j], 0, 0);
                    }
                    for(var o = 0; o < soldiers.length; o+=1) {
                        objects[i].collide(soldiers[o], 0, 0);
                    }
                    // if the objects helath is less then 0
                    if(objects[i].health <= 0) {
                        // returns the matierials the player used to build the object
                        player.wood+=object[i].gives[0];
                        player.stone+=object[i].gives[1];
                        player.gold+=object[i].gives[2];
                        player.food+=object[i].gives[3];
                        // destroys the object
                        objects.splice(i, 1);
                    }
                }
            }
            // loop through wolves
            for(var i = 0; i < wolves.length; i+=1) {
                if(player.x >= wolves[i].x - canvas.width - 37.5 && player.x <= wolves[i].x + 10 && player.y >= wolves[i].y - canvas.height - 12.5 && player.y <= wolves[i].y + 10) {
                    entitys+=1;
                    wolves[i].draw();
                    wolves[i].collide(player);
                    if(wolves[i].hp <= 0) {
                        wolves.splice(i, 1);
                        player.food+=200;
                        player.exp+=100;
                    }
                }
                wolves[i].update();
            }
            // loop through soldiers
            for(var i = 0; i < soldiers.length; i+=1) {
                // do the soldiers functions
                soldiers[i].draw();
                soldiers[i].update();
                // collide and hurt wolves
                for(var j = 0; j < wolves.length; j+=1) {
                    soldiers[i].collide(wolves[j], true);
                }
                // collide with other soldiers
                for(var o = 0; o < soldiers.length; o+=1) {
                    if(i !== o) {
                        soldiers[i].collide(soldiers[o]);
                    }
                }
                if(soldiers[i].health <= 0) {
                    soldeirs.splice(i, 1);
                }
            }
            player.ui();
            fill(255, 255, 255);
            text("Position: " + round(player.x) + ", " + round(player.y), 65, 15, 12);
            text("Health: " + round(player.hp) + "/" + "100", 65, 30, 12)
            text("Entitys: " + round(entitys), 65, 45, 12);
            if(player.hp <= 0) {
                player.reset();
                wolves = [];
                objects = [];
                scene = "menu";
            }
            fill(0, 0, 0, 0.5);
            rect(-4000 - canvas.width, -4000 - canvas.height, canvas.width * 1.5, 8000 + canvas.height * 2);
        break;
    }
    clicked = false;
    keyPress-=1;
    if(wolves.length < 100) {
        wolves.push(new wolf(0, 0));
    }
    entitys = 0;
};
draw();
start();
    </script>
</body>
</html>
